<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EZP — Home</title>

<link rel="stylesheet" href="common.css">

<style>
.container{max-width:1100px;margin:20px auto;padding:20px}

/* header */
.top-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:18px;
}
.app-title{font-size:26px;font-weight:800}
.app-sub{color:var(--muted);margin-top:6px}
.online-pill{
  padding:8px 14px;
  border-radius:20px;
  border:1px solid var(--panel-border);
  background:rgba(0,0,0,0.2);
  color:var(--accent);
  font-size:13px;
}

/* cards */
.big-cards{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}

.big-card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid var(--panel-border);
  border-radius:16px;
  padding:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.big-card .title{font-size:18px;font-weight:800}
.big-card .count{font-size:30px;font-weight:800;margin-top:8px}
.big-card .sub{color:var(--muted);font-size:13px;margin-top:4px}

.view-btn{
  border:1px solid var(--panel-border);
  background:transparent;
  color:var(--text);
  padding:8px 14px;
  border-radius:10px;
  cursor:pointer;
}

/* detail list */
.detail-box{
  margin-top:18px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid var(--panel-border);
  border-radius:16px;
  padding:16px;
}

.detail-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  border-radius:12px;
  background:rgba(255,255,255,0.01);
  margin-bottom:12px;
}

.detail-left{display:flex;gap:12px;align-items:flex-start}
.badge{
  width:36px;height:36px;border-radius:10px;
  display:grid;place-items:center;
  background:rgba(0,150,120,0.15);
  color:var(--accent);
  font-weight:800;
}

.progress{
  width:120px;height:8px;border-radius:8px;background:rgba(255,255,255,0.05);
  overflow:hidden;
}
.progress span{
  display:block;height:100%;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  width:0%;
  transition:width .6s;
}
</style>

</head>
<body>

<div class="container">

  <!-- HEADER -->
  <div class="top-header">
    <div>
      <div class="app-title">EZP Parking</div>
      <div class="app-sub">Assumption University • Live system</div>
    </div>
    <div class="online-pill">● Online • ~3s updates</div>
  </div>

  <!-- BIG CARDS -->
  <div class="big-cards" id="bigCards"></div>

  <!-- DETAIL -->
  <div class="detail-box">
    <div style="font-weight:800;margin-bottom:12px">Detail</div>
    <div id="detailList"></div>
  </div>

</div>

<!-- Bottom Nav -->
<div class="bottom-nav">
  <button class="nav-btn active" data-page="home" onclick="location='home.html'">Home</button>
  <button class="nav-btn" data-page="alerts" onclick="location='alerts.html'">Alerts</button>
  <button class="nav-btn" data-page="insights" onclick="location='insights.html'">Insights</button>
  <button class="nav-btn" data-page="settings" onclick="location='settings.html'">Settings</button>
</div>

<script>
const API = "http://localhost:3000/api";

async function loadBuildings(){
  const r = await fetch(API + "/buildings");
  return r.json();
}

async function loadStatus(id){
  const r = await fetch(API + "/buildings/" + id + "/status");
  return r.json();
}

async function renderHome(){
  const buildings = await loadBuildings();

  const big = document.getElementById("bigCards");
  const detail = document.getElementById("detailList");

  big.innerHTML = "";
  detail.innerHTML = "";

  for(const b of buildings){
    const stat = await loadStatus(b.id);

    const occPct = stat.total ? Math.round((stat.occupied/stat.total)*100) : 0;

    // BIG CARD
    const bigCard = document.createElement("div");
    bigCard.className = "big-card";
    bigCard.innerHTML = `
      <div>
        <div class="title">${b.name}</div>
        <div class="count">${stat.free} / ${stat.total}</div>
        <div class="sub">Free slots</div>
      </div>
      <button class="view-btn" onclick="location='floor.html?id=${b.id}'">View</button>
    `;
    big.appendChild(bigCard);

    // DETAIL CARD
    const item = document.createElement("div");
    item.className = "detail-item";
    item.innerHTML = `
      <div class="detail-left">
        <div class="badge">${b.code}</div>
        <div>
          <div style="font-weight:800">${b.name}</div>
          <div style="color:var(--accent);margin-top:6px">Free ${stat.free} / ${stat.total}</div>
        </div>
      </div>
      <div style="text-align:right">
        <div style="color:var(--muted);font-size:12px">just now</div>
        <div class="progress"><span style="width:${occPct}%"></span></div>
      </div>
    `;
    detail.appendChild(item);
  }
}
(function applySavedSettings(){
  const APPEAR_KEY = "ezp_appearance";
  const ACCENT_KEY = "ezp_accent";

  const mode = localStorage.getItem(APPEAR_KEY) || "system";
  const accent = localStorage.getItem(ACCENT_KEY) || "#13b5d3";

  // apply accent
  document.documentElement.style.setProperty("--accent", accent);

  // apply appearance
  if(mode === "dark"){
    document.documentElement.style.colorScheme = "dark";
  } else if(mode === "light"){
    document.documentElement.style.colorScheme = "light";
  } else {
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    document.documentElement.style.colorScheme = prefersDark ? "dark" : "light";
  }
})();
renderHome();
setInterval(renderHome, 3000);
</script>

</body>
</html>
